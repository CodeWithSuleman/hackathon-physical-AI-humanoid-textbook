# Implementation Plan: RAG Agent with OpenAI Agents SDK + FastAPI

**Branch**: `003-rag-agent-fastapi` | **Date**: 2025-12-16 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `specs/003-rag-agent-fastapi/spec.md`

**Note**: This template is filled in by the `/sp.plan` command.

## Summary

This plan outlines the implementation of a FastAPI application that serves as a RAG Agent. The agent will handle user queries via a `/query` endpoint, integrate with the existing Qdrant retrieval module (Spec-2), and generate coherent answers with source references using the OpenAI Agents SDK.

## Technical Context

**Language/Version**: Python 3.11+
**Primary Dependencies**: `fastapi`, `openai`, `qdrant-client`, `cohere`, `uvicorn`, `python-dotenv`
**Storage**: Qdrant Cloud (for document retrieval)
**Testing**: `pytest`, `httpx` (for API testing)
**Target Platform**: Any platform with Python 3.11+
**Project Type**: Web application (backend only)
**Performance Goals**: `/query` endpoint response within 3 seconds (p95 latency); handle at least 10 concurrent requests.
**Constraints**: Python + FastAPI only; use OpenAI Agents SDK for generation; connect to existing Qdrant collection; no frontend.
**Scale/Scope**: Single backend service providing RAG capabilities.

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- **I. Hands-on Learning**: The quickstart guide will enable hands-on interaction with the API.
- **II. Accuracy**: Integration with Qdrant and OpenAI Agents SDK will ensure accuracy of responses.
- **III. Clarity**: The API will have a clear, well-defined endpoint.
- **IV. Integration**: The RAG chatbot functionality adheres to only using content derived from the book, facilitated by the Qdrant retrieval.
- **V. Reproducibility**: The setup and usage instructions will ensure reproducibility.

## Project Structure

### Documentation (this feature)

```text
specs/003-rag-agent-fastapi/
├── plan.md              # This file
├── research.md          # Research on retrieval strategies and prompt engineering
├── data-model.md        # Data models for Query Request, Agent Response, and Reference
├── quickstart.md        # Quickstart guide for setting up and interacting with the API
├── contracts/           # API specifications (query_api.yaml)
└── tasks.md             # Implementation tasks (generated by /sp.tasks)
```

### Source Code (repository root)

```text
backend/
├── src/
│   ├── main.py              # FastAPI application entry point
│   ├── rag_agent/           # New directory for RAG agent logic
│   │   ├── __init__.py
│   │   ├── agent.py         # Core RAG agent implementation
│   │   └── tools.py         # OpenAI Agents SDK tools (e.g., retrieval tool)
│   └── retrieval/           # Existing retrieval module (from Spec-2)
└── tests/
    └── integration/
        └── test_rag_api.py  # Integration tests for the /query endpoint
```

**Structure Decision**: The RAG agent logic will reside in a new `rag_agent/` directory within `backend/src/`. The existing `retrieval/` module will be a dependency.

## Complexity Tracking

No violations to the constitution.